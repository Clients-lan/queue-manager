<title>FlexyQ - Register </title>
<script src="https://www.google.com/recaptcha/api.js?render=6LdQnKoZAAAAAIGiKtaJ7-Q18p32s0BHspMK7-rT"></script>

<section class="auth">
    <div class="auth-wrapper">
        <form action="/u/register" method="post">
            <% if(typeof errors != 'undefined') { %>
            <div class="alert-errors">
                <% errors.forEach(function(error) { %>
                <ul class="notify-warning">
                    <li><%= error.msg %></li>
                </ul>
                <% }); %>
            </div>
            <% } %>

            <h3>Hello there ðŸ‘‹</h3>
             <p>Come on in, there is a free trial</p>
            <div class="row">
             <input type="text" class="one-half column" placeholder="First Name" name="first">
             <input type="text" class="one-half column" placeholder="Last Name" name="last">
            </div>
            <input type="email" class="u-full-width" placeholder="Enter Email" name="email">
            <input type="password" class="u-full-width" placeholder="Enter Password" name="password">
            <input type="password" class="u-full-width" placeholder="Comfirm Password" name="password2">
            <input type="hidden" name="locisadded" value="false">
            <input type="hidden" name="plan" value="<%= plan %>">
            <input type="hidden" name="subscribed" value="false">
            <input type="hidden" name="plancode" value="<%= plancode %>">
            <input type="hidden" name="onepass" value="null">

            <button type="submit" class="btn-fill btn-block" id="send_button">Create Account</button>
             <p>Already have an account? <a href="/u/login">Login</a></p>
          </form>
    </div>

    <div id="result"></div>
    
</section>
<%- include('./components/uialert') -%>    


<script>
    function showResult(text) {
        document.querySelector('#result').innerHTML = text;
    }

    function handleClick(token) {
        return function() {
            var hello = document.querySelector('#hello').value;
            var data = {
                hello: hello,
                token: token
            };

            fetch('/send', {
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                method: 'post',
                body: JSON.stringify(data)
            })
                .then(response => response.text())
                .then(text => showResult(text))
                .catch(error => showResult(error));
        }
    }

    grecaptcha.ready(function() {
        grecaptcha.execute('6LdQnKoZAAAAAIGiKtaJ7-Q18p32s0BHspMK7-rT', {action: 'demo'})
            .then(function(token) {
                document.querySelector('#send_button').addEventListener('click', handleClick(token));
            });
    });
</script>
